## Amazon Aurora

### 1. 소개

- MySQL, PostgreSQL 기반으로 구성된 새로운 DBMS
- 10GB 로 시작하여 10GB 단위로 자동 용량 증가 (최대 128TB)
- 각 가용 영역 별 2개의 데이터 복제본 저장, 최소 3개 이상의 가용 영역 사용 (최소 6개 복제본)
- 손실된 복제본 자동 복구

### 2. 구조

- 2-1. Single-Master
  - 쓰기가 가능한 하나의 writer 와 다수의 복제본(최대 15개) 보유
  - Writer 오류 시 복제본 중 하나가 승격됨 (Failover)
  - 하나의 리전에 생성 가능

  - 쓰기 작업
    ```mermaid
          flowchart TD
          
          EO[EC2]
          
          EO --> |1-1. 쓰기 요청|AR1
          AR1 --> |1-2. Storage node 쓰기|SN1 & SN2 & SN3 & SN4 & SN5 & SN6
    
          subgraph AZ1[Availability zone]
              ASC1
              AR1["Writer"]
          end
      
          subgraph AZ2[Availability zone]
              ASC2
              AR2["Aurora Replica"]
              
          end
      
          subgraph AZ3[Availability zone]
              ASC3
              AR3["Aurora Replica"]
              
          end
    
          subgraph ASC1["Aurora storage cluster"]
              SN1[Storage node]
              SN2[Storage node]
          end
    
          subgraph ASC2["Aurora storage cluster"]
              SN3[Storage node]
              SN4[Storage node]
          end
    
          subgraph ASC3["Aurora storage cluster"]
              SN5[Storage node]
              SN6[Storage node]
          end
    ```

  - 읽기 작업
    ```mermaid
          flowchart TD
          
          EO[EC2]
    
          SN4 --> |1. Storage node 읽기|AR2 & AR3
          AR2 & AR3 --> |2. 읽기 요청|EO
    
          subgraph AZ1[Availability zone]
              ASC1
              AR1["Writer"]
          end
      
          subgraph AZ2[Availability zone]
              ASC2
              AR2["Aurora Replica"]
              
          end
      
          subgraph AZ3[Availability zone]
              ASC3
              AR3["Aurora Replica"]
              
          end
    
          subgraph ASC1["Aurora storage cluster"]
              SN1[Storage node]
              SN2[Storage node]
          end
    
          subgraph ASC2["Aurora storage cluster"]
              SN3[Storage node]
              SN4[Storage node]
          end
    
          subgraph ASC3["Aurora storage cluster"]
              SN5[Storage node]
              SN6[Storage node]
          end
    ```

- 2-2. Multi-Master
  - 읽기/쓰기가 가능한 최대 4개의 Writer 보유
  - 쓰기 부하 분산 가능

  ```mermaid
          flowchart TD
          
          EO[EC2]
          
          EO --> |1-1. 쓰기 요청|AR1
          AR1 --> |1-2. Storage node 쓰기|SN1 & SN2 & SN3 & SN4 & SN5 & SN6
          AR2 --> |1-2. Storage node 쓰기|SN1 & SN2 & SN3 & SN4 & SN5 & SN6
    
          subgraph AZ1[Availability zone]
              ASC1
              AR1["Writer"]
          end
      
          subgraph AZ2[Availability zone]
              ASC2
              AR2["Writer"]
              
          end
      
          subgraph AZ3[Availability zone]
              ASC3
              
          end
    
          subgraph ASC1["Aurora storage cluster"]
              SN1[Storage node]
              SN2[Storage node]
          end
    
          subgraph ASC2["Aurora storage cluster"]
              SN3[Storage node]
              SN4[Storage node]
          end
    
          subgraph ASC3["Aurora storage cluster"]
              SN5[Storage node]
              SN6[Storage node]
          end
    ```

### 3. 병렬 쿼리

- 다수의 읽기 노드를 통해 쿼리를 병렬로 처리하는 모드
- t2, t3 인스턴스 유형에서는 미지원

### 4. 백업

- MySQL DB 의 Binary log 복제
- 다른 리전에서만 생성 가능
- 최대 35일 S3 자동 백업, 수동 스냅샷 백업 존재

### 5. Backtrack

- Single-Master 의 MySQL 버전에서만 가능
- 기존 DB를 특정 시점으로 롤백 (신규 인스턴스 생성 불필요)
- 새로운 DB 를 생성하여 복구하는 것보다 빠른 복구 가능