## RDS (Relational Database Service)

### 1. 소개

- 클라우드 환경에서 관계형 데이터베이스를 제공하는 서비스
- 가상 머신 위에서 동작하고 서버리스는 아님
- 생성 시 인스턴스 타입, EBS 용량 설정 필요

### 2. 인증

- ID/PW 방식
  - AWS secret manager 와 연동


- IAM DB 인증
  - IAM 의 인증 정보와 역할을 연동하여 관리


- Kerberos 인증
  - Microsoft 의 대칭 키 기반 인증 프로토콜

### 3. 호환 DBMS

- 라이선스 필요
  - MS-SQL server
  - Oracle


- 라이선스 불필요
  - MySQL
  - PostgreSQL
  - MariaDB
  - **Amazon Aurora**

### 4. 백업

- 새로운 DB 인스턴스 생성 후 롤백 가능


- 자동 백업 (기본값)
  - 매일 스냅샷 생성, 트랜잭션 로그 저장
  - S3에 저장되어 DB 크기 만큼 공간 점유
  - 최대 35일 까지 보관 지원


- 수동 백업
  - 수동 요청에 따라 스냅샷 생성
  - DB 삭제 이후에도 계속 보관됨

### 5. 구조

- 5-1. Multi-AZ (고가용성 중시)
  - 두 개 이상의 availability zone 에 DB를 구축하고 Primary, Standby 를 자동으로 동기화
  - Primary DB 오류 발생 시 Standby DB 가 Primary 로 변경됨 (Failover)
  - Standby DB 의 경우 직접 접근 불가 (DNS 를 통한 접근 필요)
    ```mermaid
        flowchart TD
          
        subgraph AZ[Availability zone]
            R1 & R2
        end
  
        subgraph R1["RDS (Primary)"]
            E1[Instance]
            EBS1[(EBS)]
  
            E1 --> EBS1
        end
  
        subgraph R2["RDS (Standby)"]
            E2[Instance]
            EBS2[(EBS)]
          
            E2 --> EBS2
        end
      
        E1 --> |Sync 복제|E2
    ```

  - 5-2. Read replica (성능 중시)
    - 쓰기는 Primary DB, 읽기는 Replica DB 에서 처리
    - MySQL, PostgreSQL, MariaDB, Oracle, Aurora 에서 지원
    - 복제 시 딜레이 존재
    ```mermaid
        flowchart TD
        
        EO[EC2]
        
        EO --> |쓰기<br>myrdswrite.amazonaws.com|E1
        EO --> |읽기<br>myrdsread01.amazonaws.com|E2
    
        subgraph AZ[Availability zone]
            R1 & R2 & R3
        end
  
        subgraph R1["RDS (Primary)"]
            E1[Instance]
            EBS1[(EBS)]
  
            E1 --> EBS1
        end
  
        subgraph R2["RDS (Read-only Replica)"]
            E2[Instance]
            EBS2[(EBS)]
          
            E2 --> EBS2
        end
    
        subgraph R3["RDS (Read-only Replica)"]
            E3[Instance]
            EBS3[(EBS)]
          
            E3 --> EBS3
        end
      
        E1 --> |Sync 복제|E2
        E1 --> |Sync 복제|E3
    ```

- 5-3. RDS multi region (리전 별 성능 중시, 안정성)
  - 여러 리전에 지속적인 동기화를 제공해주는 DB 클러스터 생성
  - 각 리전 별 자동 백업, Multi-AZ 구성 가능
  - 복제 시 딜레이 존재